jenkins {
    jobs {
        "AUTOPYLOT_DBG_TESTSYSTEM_SMOKETEST_MULTIJOB" {
            type "Multijob"
            dsl {
                description("""Multi Job triggering 3 Smoke Test sets, covering all products and ticket types and tenants...
				""")

				    parameters {
                    stringParam 'ANSIBLE_VARIABLES', 'instance_type: "m5.4xlarge"', "Configuration of the AWS machine"
                    stringParam 'CARA', 'latest', "Cara Version to Test, latest for live version"
                    stringParam 'ALINGHI', 'latest', "Alinghi Version to Test, latest for master"
			    	}

                    concurrentBuild true

                    steps {
                       phase("Delete systems before creation to ensure there is nothing interrupting") {
                                 phaseJob("AUTOPYLOT_DELETE_TESTSYSTEM"){
                                          parameters{
                                               predefinedProp("TESTSYSTEM", "app-smoketest01-dbg.test.t24.eu-west-1.sg-cloud.co.uk")
                                          }
                                 }
                                 phaseJob("AUTOPYLOT_DELETE_TESTSYSTEM"){
                                          parameters{
                                               predefinedProp("TESTSYSTEM", "app-smoketest02-dbg.test.t24.eu-west-1.sg-cloud.co.uk")
                                          }
                                 }
                                 phaseJob("AUTOPYLOT_DELETE_TESTSYSTEM"){
                                          parameters{
                                               predefinedProp("TESTSYSTEM", "app-smoketest03-dbg.test.t24.eu-west-1.sg-cloud.co.uk")
                                          }
                                 }
                       }

                       phase("Test system creation") {
                                 phaseJob("AUTOPYLOT_CREATE_TESTSYSTEM"){
                                          parameters{
                                               predefinedProp("TESTSYSTEM", "app-smoketest01-dbg.test.t24.eu-west-1.sg-cloud.co.uk")
                                               predefinedProp('ANSIBLE_VARIABLES', '$ANSIBLE_VARIABLES')
                                          }
                                 }
                                 phaseJob("AUTOPYLOT_CREATE_TESTSYSTEM"){
                                          parameters{
                                               predefinedProp("TESTSYSTEM", "app-smoketest02-dbg.test.t24.eu-west-1.sg-cloud.co.uk")
                                               predefinedProp('ANSIBLE_VARIABLES', '$ANSIBLE_VARIABLES')
                                          }

                                 }
                                 phaseJob("AUTOPYLOT_CREATE_TESTSYSTEM"){
                                          parameters{
                                               predefinedProp("TESTSYSTEM", "app-smoketest03-dbg.test.t24.eu-west-1.sg-cloud.co.uk")
                                               predefinedProp('ANSIBLE_VARIABLES', '$ANSIBLE_VARIABLES')
                                          }
                                 }
                       }

                       phase("Test system deployment") {
                                 phaseJob("AUTOPYLOT_DEPLOY_TESTSYSTEM"){
                                            parameters{
                                              predefinedProp('TESTSYSTEM', 'app-smoketest01-dbg.test.t24.eu-west-1.sg-cloud.co.uk')
                                              predefinedProp('VERSION_ALINGHI', '$ALINGHI')
                                              predefinedProp('VERSION_CARA', '$CARA')
                                            }
                                 }
                                 phaseJob("AUTOPYLOT_DEPLOY_TESTSYSTEM"){
                                            parameters{
                                              predefinedProp('TESTSYSTEM', 'app-smoketest02-dbg.test.t24.eu-west-1.sg-cloud.co.uk')
                                              predefinedProp('VERSION_ALINGHI', '$ALINGHI')
                                              predefinedProp('VERSION_CARA', '$CARA')
                                            }
                                 }
                                 phaseJob("AUTOPYLOT_DEPLOY_TESTSYSTEM"){
                                            parameters{
                                              predefinedProp('TESTSYSTEM', 'app-smoketest03-dbg.test.t24.eu-west-1.sg-cloud.co.uk')
                                              predefinedProp('VERSION_ALINGHI', '$ALINGHI')
                                              predefinedProp('VERSION_CARA', '$CARA')
                                            }
                                 }
                       }

                       phase("Test execution") {
                                 continuationCondition('SUCCESSFUL')
                                 phaseJob("AUTOPYLOT_DBG_TESTSYSTEM_SMOKETEST_CYCLE_1"){
                                               parameters{
                                                 predefinedProp('TESTSYSTEM', 'app-smoketest01-dbg.test.t24.eu-west-1.sg-cloud.co.uk')
                                               }
                                 }
                                 phaseJob("AUTOPYLOT_DBG_TESTSYSTEM_SMOKETEST_CYCLE_2"){
                                               parameters{
                                                 predefinedProp('TESTSYSTEM', 'app-smoketest02-dbg.test.t24.eu-west-1.sg-cloud.co.uk')
                                               }
                                 }
                                 phaseJob("AUTOPYLOT_DBG_TESTSYSTEM_SMOKETEST_CYCLE_3"){
                                               parameters{
                                                 predefinedProp('TESTSYSTEM', 'app-smoketest03-dbg.test.t24.eu-west-1.sg-cloud.co.uk')
                                               }
                                 }
                       }

                       phase("Delete systems after a SUCCESSFUL test execution") {
                                 phaseJob("AUTOPYLOT_DELETE_TESTSYSTEM"){
                                            parameters{
                                               predefinedProp("TESTSYSTEM", "app-smoketest01-dbg.test.t24.eu-west-1.sg-cloud.co.uk")
                                            }                                 }
                                 phaseJob("AUTOPYLOT_DELETE_TESTSYSTEM"){
                                            parameters{
                                               predefinedProp("TESTSYSTEM", "app-smoketest02-dbg.test.t24.eu-west-1.sg-cloud.co.uk")
                                            }
                                 }
                                 phaseJob("AUTOPYLOT_DELETE_TESTSYSTEM"){
                                            parameters{
                                               predefinedProp("TESTSYSTEM", "app-smoketest03-dbg.test.t24.eu-west-1.sg-cloud.co.uk")
                                            }
                                 }
                       }


                        logRotator {
                            artifactNumToKeep(96)
                            daysToKeep 7
                            numToKeep 64
                        }
                        wrappers {
                            colorizeOutput()
                            timestamps()
                        }
                    }
                }
            }
        }

    }